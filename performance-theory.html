
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Performance theory</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_lesson.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_charts/charts.css" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/overrides.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/minipres.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/sphinx_charts/plotly/plotly-2.8.3.min.js"></script>
    <script src="_static/sphinx_charts/charts.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Scaling study: self-consistent field calculations" href="scf-scaling-study.html" />
    <link rel="prev" title="Modern HPC architectures" href="modern-hpc-architectures.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/ENCCS-PDC-logos.jpg" class="logo" alt="logo">
      
      
    </a>
</div><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   VeloxChem: quantum chemistry towards pre-exascale and beyond
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="setup.html">
   Setting up your system
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hpc-setup.html">
   Setting up VeloxChem on a HPC cluster
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The lesson
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="notebooks/first-steps.html">
   First steps with VeloxChem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="modern-hpc-architectures.html">
   Modern HPC architectures
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Performance theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="scf-scaling-study.html">
   Scaling study: self-consistent field calculations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eri-overview.html">
   An overview of electron-repulsion integral evaluation algorithms
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linrsp-scaling-study.html">
   Scaling study: excitation energies with linear response
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="x-ray-cpp.html">
   Complex polarization propagator in the X-ray region
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exciton.html">
   Exciton calculation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ntos.html">
   Natural transition orbitals
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="quick-reference.html">
   Quick Reference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zbibliography.html">
   Bibliography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="guide.html">
   Instructor’s guide
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/performance-theory.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ENCCS/veloxchem-hpc"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/ENCCS/veloxchem-hpc/issues/new?title=Issue%20on%20page%20%2Fperformance-theory.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/ENCCS/veloxchem-hpc/edit/main/content/performance-theory.rst"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scalability">
   Scalability
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#amdahl-s-law">
     Amdahl’s law
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gustafson-s-law">
     Gustafson’s law
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Performance theory</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scalability">
   Scalability
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#amdahl-s-law">
     Amdahl’s law
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gustafson-s-law">
     Gustafson’s law
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="performance-theory">
<span id="id1"></span><h1>Performance theory<a class="headerlink" href="#performance-theory" title="Permalink to this headline">¶</a></h1>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand the different meanings of performance.</p></li>
<li><p>Familiarize with theoretical models of performance analysis.</p></li>
</ul>
</div>
<p>Quantum chemical programs must be written in an explicitly parallel fashion in
order to harness the computational power offered by the increasing number of
cores that can be packed on modern chips.
The effort expended in parallelizing or improving parallelization of a program
needs to be measured against suitable metrics to be justified. The term
“performance” has many meanings in this context.
A code has improved performance compared to another, if it:</p>
<ul class="simple">
<li><p>Shows lower <strong>latency</strong>, <em>i.e.</em> it computes a single result in less time.</p></li>
<li><p>Shows higher <strong>throughput</strong>, <em>i.e.</em> it computes a bunch of results at a higher
rate.</p></li>
<li><p>Consumes less power.</p></li>
</ul>
<p>In quantum chemistry we are mostly interested in reducing the <strong>total time to
solution</strong>, <em>i.e.</em> the latency of a computation.
It is thus quite natural to evaluate parallel performance in terms of the <em>speedup</em> and <em>efficiency</em> metrics:</p>
<dl>
<dt>Speedup</dt><dd><p>The ratio of serial and parallel times to solution.</p>
<div class="math notranslate nohighlight">
\[\mathrm{speedup} = \frac{T_{1}}{T_{P}}\]</div>
</dd>
<dt>Efficiency</dt><dd><p>The speedup per unit of parallel worker.</p>
<div class="math notranslate nohighlight">
\[\mathrm{efficiency} = \frac{\mathrm{speedup}}{P} = \frac{T_{1}}{PT_{P}}\]</div>
</dd>
</dl>
<p>The serial time to solution <span class="math notranslate nohighlight">\(T_{1}\)</span> might be that of the <em>serialized</em>
parallel program, that is the parallel algorithm running with <span class="math notranslate nohighlight">\(P=1\)</span>
workers. Speedup and efficiency are then said to be <em>relative</em>.
These metrics are said to be <em>absolute</em> if <span class="math notranslate nohighlight">\(T_{1}\)</span> is measured using a
serial algorithm that does not parallelize well.</p>
<p>Observed speedups are usually <em>sublinear</em>: running on <span class="math notranslate nohighlight">\(P\)</span> workers is a
factor of <span class="math notranslate nohighlight">\(&lt; P\)</span> faster. Ideally, one would want to observe <em>linear</em>
speedups, but this is very hard to achieve in practice, due, for example, to the
overhead incurred in distributing computation among workers.
In rare cases, <em>superlinear</em> speedup might be observed, usually due to favorable
combinations of cache-friendliness and efficient use of vectorization.</p>
<div class="section" id="scalability">
<h2>Scalability<a class="headerlink" href="#scalability" title="Permalink to this headline">¶</a></h2>
<p><em>Scalability</em> is the ability of hardware and software to deliver increased
performance as a function of the resources used.</p>
<p>There are two metrics to consider:</p>
<dl class="simple">
<dt>Strong scalability</dt><dd><p>The ability of an algorithm to obtain speedup for a <strong>fixed problem size</strong> and
an <strong>increasing number of workers</strong>.</p>
</dd>
<dt>Weak scalability</dt><dd><p>The ability of an algorithm to obtain speedup for an <strong>increasing problem
size</strong> and an <strong>increasing number of workers</strong>.</p>
</dd>
</dl>
<p>Let’s take a closer look at the measured latencies <span class="math notranslate nohighlight">\(T_{1}\)</span> and
<span class="math notranslate nohighlight">\(T_{P}\)</span>.  Both are the sum of the fractions executed in serial or in
parallel. While for <span class="math notranslate nohighlight">\(T_{1}\)</span> it holds:</p>
<div class="math notranslate nohighlight">
\[T_{1} = W_{\mathrm{ser}} + W_{\mathrm{par}}\]</div>
<p>for <span class="math notranslate nohighlight">\(T_{P}\)</span> we have:</p>
<div class="math notranslate nohighlight">
\[T_{P} \geq W_{\mathrm{ser}} + \frac{W_{\mathrm{par}}}{P}\]</div>
<p>the equality being valid for a “perfect” parallelization.</p>
<div class="section" id="amdahl-s-law">
<span id="amdahl"></span><h3>Amdahl’s law<a class="headerlink" href="#amdahl-s-law" title="Permalink to this headline">¶</a></h3>
<p>Let’s assume that there is a <em>constant</em> fraction <span class="math notranslate nohighlight">\(f\)</span> of <span class="math notranslate nohighlight">\(T_{1}\)</span> that is serial, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
W_{\mathrm{ser}} &amp;= fT_{1} \\
W_{\mathrm{par}} &amp;= (1-f)T_{1}
\end{align}\end{split}\]</div>
<p>This gives an upper bound on the achievable speedup and efficiency as a function
of the serial fraction:</p>
<div class="math notranslate nohighlight">
\[\mathrm{speedup} \leq \frac{1}{f + (1-f)P}\]</div>
<p>also known as <strong>Amdahl’s law</strong> <span id="id2">[<a class="reference internal" href="zbibliography.html#id13" title="Gene M Amdahl. Validity of the single processor approach to achieving large scale computing capabilities. In Proceedings of the April 18-20, 1967, spring joint computer conference, AFIPS '67 (Spring), 483–485. New York, NY, USA, April 1967. Association for Computing Machinery. URL: https://doi.org/10.1145/1465482.1465560, doi:10.1145/1465482.1465560.">Amd67</a>]</span>.</p>
<div class="sphinx-charts docutils container" id="id4">
<div class="sphinx-charts-chart sphinx-charts-chart-id-0 sphinx-charts-chart-uri-_charts/charts/amdahl-speedup.json sphinx-charts-chart-dn-chart docutils container" id="sphinx-charts-chart-id-0">
</div>
<p class="sphinx-charts-hidden"></p>
<div class="sphinx-charts-placeholder sphinx-charts-placeholder-0 docutils container" id="id5">
<p class="caption"><span class="caption-text">Loading…</span></p>
</div>
<p class="caption"><span class="caption-text">Strong scaling, in terms of achievable <strong>speedup</strong>, as a function of the number of
workers, according to Amdahl’s law.  We consider different values of the
serial fraction <span class="math notranslate nohighlight">\(f\)</span>.</span></p>
</div>
<div class="sphinx-charts docutils container" id="id6">
<div class="sphinx-charts-chart sphinx-charts-chart-id-1 sphinx-charts-chart-uri-_charts/charts/amdahl-efficiency.json sphinx-charts-chart-dn-chart docutils container" id="sphinx-charts-chart-id-1">
</div>
<p class="sphinx-charts-hidden"></p>
<div class="sphinx-charts-placeholder sphinx-charts-placeholder-1 docutils container" id="id7">
<p class="caption"><span class="caption-text">Loading…</span></p>
</div>
<p class="caption"><span class="caption-text">Strong scaling, in terms of achievable <strong>efficiency</strong>, as a function of the
number of workers, according to Amdahl’s law.  We consider different values
of the serial fraction <span class="math notranslate nohighlight">\(f\)</span>.</span></p>
</div>
<p>Quite pessimistically, in the limit of an infinite number of workers, strong
scalability is essentially bound by the serial fraction:</p>
<div class="math notranslate nohighlight">
\[\mathrm{speedup}_{\infty} \leq \frac{1}{f}\]</div>
</div>
<div class="section" id="gustafson-s-law">
<span id="gustafson"></span><h3>Gustafson’s law<a class="headerlink" href="#gustafson-s-law" title="Permalink to this headline">¶</a></h3>
<p>20 years after Amdahl published his paper on strong scalability, Gustafson noted
an important fact: more capable hardware is usually applied to larger problems,
leading to observed speedups exceeding what would be predicted by Amdahl’s law.
<span id="id3">[<a class="reference internal" href="zbibliography.html#id12" title="John L Gustafson. Reevaluating Amdahl's law. Commun. ACM, 31(5):532–533, May 1988. URL: https://doi.org/10.1145/42411.42415, doi:10.1145/42411.42415.">Gus88</a>]</span></p>
<p>How is this possible? We must make two assumptions:</p>
<ol class="arabic simple">
<li><p>That the serial part of our algorithm remains constant when the problem size
increases.</p></li>
<li><p>That the parallel part grows <em>linearly</em> with the number of workers.</p></li>
</ol>
<div class="figure align-center" id="id8">
<a class="reference internal image-reference" href="_images/amdahl-vs-gustafson.svg"><img alt="_images/amdahl-vs-gustafson.svg" height="286" src="_images/amdahl-vs-gustafson.svg" width="712" /></a>
<p class="caption"><span class="caption-text">In a strong scalability regime, the amount of work remains constant, while
the capability of the machine to perform parallel work increase.
Asymptotically, the speedup is dominated by the fraction of work executed
serially, as observed by Amdahl.
However, increasing the amount of work proportionally to the parallel
capabilities, will eventually let the serial portion become insignificant to
the total time to solution.</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<p>When exploring weak scalability, the <strong>scaled speedup</strong> is our figure of merit:</p>
<div class="math notranslate nohighlight">
\[\text{scaled speedup} = P + (1-P)f\]</div>
<p>This metric grows <em>linearly</em> with the number of workers.</p>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>Time to solution is the performance metric most often used in quantum
chemistry.</p></li>
<li><p>Strong calability of an application depends on the fraction of serial work
performed.</p></li>
<li><p>In practice, more capable hardware is employed on larger problems: we might
be able to observe weak scalability even without removing serial
bottlenecks.</p></li>
</ul>
</div>
</div>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="modern-hpc-architectures.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Modern HPC architectures</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="scf-scaling-study.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Scaling study: self-consistent field calculations</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By The contributors<br/>
    
        &copy; Copyright 2022, The contributors.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>